<%- include('partials/header') %>
<% if (!user) { %>

    <script>
        location.assign('/login');
    </script>

<%} %>

<% if (user, book) { %>
<h1 class="capitalize"><%= book.title %></h1>
<h2 class="capitalize"><%= book.author %></h2>
<p class="capitalize"><strong>Price: </strong> <%= book.price %></p>
<p class="capitalize"><strong>ISBN #: </strong><%= book.ISBN %></p>
<figure>
    <img class="mx-auto my-4" src="http://covers.openlibrary.org/b/isbn/<%= book.ISBN %>-L.jpg" alt="<%= book.title %>">
</figure>
<% } %> 

<% if (edit, book) { %>
    <h3 class="text-3xl text-black text-center mx-auto my-4 font-bold">Edit Book Here</h3>
<form action="" id="editBook" class="w-1/3 mx-auto p-4 text-white bg-green-400">
    <div class="form-control block mx-auto my-2">
        <label class="inline-block w-36 text-left" for="title">Title: </label>
        <input type="text" class="bg-green-200 text-black" name="title" id="bookTitle" value="<%= book.title %>" placeholder="<%= book.title %>">
    </div>
    <div class="form-control block mx-auto my-2">
        <label class="inline-block w-36 text-left" for="author">Author: </label>
        <input type="text" class="bg-green-200 text-black" name="author" id="bookAuthor" value="<%= book.author %>" placeholder="<%= book.author %>">
    </div>
    <div class="form-control block mx-auto my-2">
    <label class="inline-block w-36 text-left" for="price">Price: </label>
        <input type="text" class="bg-green-200 text-black" name="price" id="bookPrice" value="<%= book.price %>" placeholder="<%= book.price %>">
    </div>
    <div class="form-control block mx-auto my-2">
        <label class="inline-block w-36 text-left" for="ISBN">ISBN: </label>
        <input type="text" class="bg-green-200 text-black" name="ISBN" id="bookISBN" value="<%= book.ISBN %>" placeholder="<%= book.ISBN %>">
    </div>
    <div class="form-control block mx-auto my-2">
        <button class="rounded p-3 m-3 border-2 bg-green-200 text-black hover:bg-green-600 hover:text-white transition duration-200" type="submit">Submit</button>
        <button class="rounded p-3 m-3 border-2 bg-green-200 text-black hover:bg-green-600 hover:text-white transition duration-200" type="reset">Reset</button>
    </div>
</form>
<script>
    const form = document.getElementById('editBook');

    form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = form.title.value;
            const author = form.author.value;
            const price = form.price.value;
            const ISBN = form.ISBN.value;
            try {
                const res = await fetch('/api/v1/books/<%= book._id %>', {
                method: 'PATCH',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({title, author, price, ISBN})
            })
            const data = await res.json();
            console.log(data);
            if (data.book) {
                location.assign('/edit-books');
            } else {
                console.log(data);
            }
    
            } catch (err) {
                return console.log(err);
            }
        })
</script>
<% } %>


<%- include('partials/footer') %>

